generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

// ---------------- ENUMS ----------------

enum UserRole {
  COMPANY_ADMIN // Administrador de Empresa
  EMPLOYEE      // Empleado
  SUPPORT_TECH  // Técnico de Soporte
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum CompanyStatus {
  ACTIVE
  INACTIVE
}

enum TechStatus {
  AVAILABLE       // Disponible
  BUSY            // Ocupado
  OUT_OF_SERVICE  // Fuera de Servicio
}

enum ExperienceLevel {
  JUNIOR
  MID
  SENIOR
  EXPERT
}

// ---------------- MODELOS ----------------

model Company {
  id_company        Int           @id @default(autoincrement())
  legalName         String        // Nombre Legal / Razón Social
  taxId             String        @unique // CUIT / RFC
  address           String        // Domicilio
  phone             String        // Teléfono general
  email             String        // Email corporativo
  inviteCode        String        @unique // CÓDIGO TIPO CLASSROOM (Llave de acceso)
  createdAt         DateTime      @default(now())
  status            CompanyStatus @default(ACTIVE)
  
  // Relación: Administrador Principal (Vínculo al usuario)
  mainAdminId_fk    Int?          @unique 
  mainAdmin         User?         @relation("MainAdmin", fields: [mainAdminId_fk], references: [id_user])

  // Relaciones inversas
  users             User[]        @relation("CompanyUsers")
  areas             Area[]
}

model Area {
  id_area           Int      @id @default(autoincrement())
  name              String
  id_company_fk     Int
  company           Company  @relation(fields: [id_company_fk], references: [id_company])

  // Relaciones inversas
  employees         User[]   @relation("EmployeeArea") // Empleados de esta área
  specializedTechs  User[]   @relation("TechSpecialization") // Técnicos especialistas en esta área
}

model User {
  id_user           Int        @id @default(autoincrement())
  firstName         String     // Nombre
  lastName          String     // Apellido
  email             String     @unique // Credencial de acceso única
  password          String     // Hash de la contraseña
  role              UserRole   // Rol (ADMIN, EMPLOYEE, TECH)
  phone             String?    // Teléfono (Opcional)
  accountStatus     UserStatus @default(ACTIVE)
  createdAt         DateTime   @default(now())

  // RELACIÓN CON EMPRESA:
  // Se ha cambiado a opcional (Int?) para permitir que empleados/técnicos 
  // se registren solos antes de ser vinculados a una organización.
  id_company_fk     Int?
  company           Company?    @relation("CompanyUsers", fields: [id_company_fk], references: [id_company])

  // CAMPOS ESPECÍFICOS:
  // Estos campos se llenarán conforme el usuario complete su perfil
  id_area_fk        Int?       // Solo para Empleados vinculados a un área
  area              Area?      @relation("EmployeeArea", fields: [id_area_fk], references: [id_area])

  experienceLevel   ExperienceLevel? // Solo para Técnicos
  techStatus        TechStatus?      // Disponibilidad del técnico
  specializations   Area[]           @relation("TechSpecialization")

  managedCompany    Company?         @relation("MainAdmin")
}